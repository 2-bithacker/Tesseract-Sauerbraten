//---crnsp1 cfg V:1.1
maptitle "^f2- ^f3Missile Pass ^f7 by ^f6C^f2lemens ^f0'^f6crun^f0' ^f6Run^f2ge ^f2-"

//--mapsettings

yawsky 150
fog 2000
fogdomecolour 96 142 116
fogdomeheight -0.4
fogdomemax 1
fogdomemin 0.5
sunlightyaw 230
sunlightpitch 26
sunlight 120 110 80
cloudlayer "skyboxes/clouds01.png"
cloudscale 7
cloudcolour 150 200 180
cloudscrollx 0.0006
cloudscrolly -0.0009
cloudalpha 0.9
cloudheight 0.2
cloudfade 0.3
skylight 65 80 50

//--models

mapmodelreset

mmodel "doors/door_01"
mmodel "doors/door_02"
mmodel "doors/door_03"
mmodel "doors/door_04"
mmodel "mitaman/door_06"
mmodel "mitaman/door_07"
mmodel "mitaman/door_08"
mmodel "mitaman/door_09"
mmodel "mitaman/door_10"
mmodel "switch1"
mmodel "switch2"
mmodel "dcp/switch2a"
mmodel "mitaman/plat01/crnsp1_196"
mmodel "mapmodels/nieb/waterfall/1"
mmodel "mapmodels/nieb/waterfall/2"
mmodel "mapmodels/nieb/waterfall/3"
mmodel "mapmodels/nieb/waterfall/4"
mmodel "steve_e/doors/trapdoor/trapdoor_200"
mmodel "mitaman/floorgrate1/crnsp1"
mmodel "mitaman/plat01"
mmodel "mapmodels/crun/transparentbox"
mmodel "psionic/barrel2"
mmodel "xeno/box1"
mmodel "carrot"
mmodel "doors/door_04/crnsp1"
mmodel "mitaman/door_10/crnsp1"
mmodel "mitaman/plat01/crnsp1_296"

//--mapsounds

mapsound ambience/wind 255
mapsound ambience/waterfall 150
mapsound kaiser/fx/hum6 175
mapsound kaiser/fx/hum1 175

crnsp_warning = (registersound "kaiser/fx/warning1" 150)
crnsp_timertick = (registersound "q009/weapswitch" 255)

//--textures

texturereset

setshader stdworld				// use default world shader unless specified otherwise
texture 0 "textures/sky.png"	// dummy sky texture
texture 0 "textures/default.png"// default geometry texture

//-gor

setshader bumpspecmapparallaxworld
	setshaderparam "specscale" 4 4 4
	setshaderparam "parallaxscale" 0.02 -0.01

	texture 0 gor/WS_GK_001_cc.jpg
	texture n gor/WS_GK_001_nm.jpg
	texture s gor/WS_GK_001_sc.jpg
	texture z gor/WS_GK_001_hm.jpg

	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	
setshader bumpspecmapparallaxworld
	setshaderparam "specscale" 4 4 4
	setshaderparam "parallaxscale" 0.02 -0.01

	texture 0 gor/GR_GK_007_cc.jpg
	texture n gor/GR_GK_007_nm.jpg
	texture s gor/GR_GK_007_sc.jpg
	texture z gor/GR_GK_007_hm.jpg
	
setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld
	setshaderparam "specscale" 4 4 4
	setshaderparam "parallaxscale" 0.02 -0.01	

	texture 0 gor/ST_GK_003_cc.jpg
	texture n gor/ST_GK_003_nm.jpg
	texture s gor/ST_GK_003_sc.jpg
	texture z gor/ST_GK_003_hm.jpg

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld
	setshaderparam "specscale" 4 4 4
	setshaderparam "parallaxscale" 0.02 -0.01

	texture 0 gor/WO_GK_002_cc.jpg
	texture n gor/WO_GK_002_nm.jpg
	texture s gor/WO_GK_002_sc.jpg
	texture z gor/WO_GK_002_hm.jpg

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld
	setshaderparam "specscale" 4 4 4
	setshaderparam "parallaxscale" 0.02 -0.01

	texture 0 gor/WT_GK_017_cc.jpg
	texture n gor/WT_GK_017_nm.jpg
	texture s gor/WT_GK_017_sc.jpg
	texture z gor/WT_GK_017_hm.jpg

setshader stdworld
	texture 0 "textures/default.png"
	
setshader bumpspecmapparallaxworld
	setshaderparam "specscale" 4 4 4
	setshaderparam "parallaxscale" 0.02 -0.01

	texture 0 gor/ME_GK_012_cc.jpg
	texture n gor/ME_GK_012_nm.jpg
	texture s gor/ME_GK_012_sc.jpg
	texture z gor/ME_GK_012_hm.jpg

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

//-tech1soc

setshader stdworld

	texture 0 tech1soc/spring3.jpg

setshader glowworld

	texture 0 tech1soc/sqrlig02wb.jpg
	texture g tech1soc/sqrlig02wb_g.jpg
	texture 0 tech1soc/sqrlig03bc.jpg
	texture g tech1soc/sqrlig03bc_g.jpg

setshader stdworld

	texture 0 tech1soc/zdetlig01bb.jpg
	texture 0 tech1soc/zdetlig02bb.jpg
	texture 0 tech1soc/zdetlig04bb.jpg
	texture 0 tech1soc/zdet_trim2a.jpg
	texture 0 tech1soc/zdet_trim5b.jpg
	texture 0 tech1soc/032-01c.jpg
	texture 0 tech1soc/032-02b.jpg
	texture 0 tech1soc/032-03d.jpg
	texture 0 tech1soc/032-10a.jpg
	texture 0 tech1soc/032-10b.jpg
	texture 0 tech1soc/032-12d.jpg
	texture 0 tech1soc/032-14b.jpg
	texture 0 tech1soc/032-15a.jpg
	texture 0 tech1soc/032-15b.jpg

setshader glowworld

	texture 0 tech1soc/032lig10bb.jpg
	texture g tech1soc/032lig10bb_g.jpg
	texture 0 tech1soc/032lig11bb.jpg
	texture g <rotate:1>tech1soc/032lig11rb_g.jpg
	texture 0 tech1soc/032lig11rb.jpg
	texture g tech1soc/032lig11rb_g.jpg
	texture 0 tech1soc/032lig12bb.jpg
	texture g tech1soc/032lig12bb_g.jpg
	texture 0 tech1soc/032lig12rb.jpg
	texture g tech1soc/032lig12bb_g.jpg
	texture 0 tech1soc/032lig12ya.jpg 
	texture g tech1soc/032lig12bb_g.jpg
	texture 0 tech1soc/032lig20yb.jpg
	texture g tech1soc/032lig20yb_g.jpg
	
setshader stdworld

	texture 0 tech1soc/064-11b.jpg
	texture 0 tech1soc/064-12a.jpg
	texture 0 tech1soc/064-13b.jpg
	texture 0 tech1soc/064-15b.jpg
	texture 0 tech1soc/064-20a.jpg
	texture 0 tech1soc/064-20b.jpg
	texture 0 tech1soc/064-22b.jpg
	
setshader glowworld

	texture 0 tech1soc/064lig20bb.jpg
	texture g tech1soc/064lig20bb_g.jpg
	texture 0 tech1soc/064lig22bb.jpg
	texture g tech1soc/064lig22wb_g.jpg
	texture 0 tech1soc/064lig22rb.jpg
	texture g tech1soc/064lig22rb_g.jpg
	texture 0 tech1soc/064lig22wb.jpg
	texture g tech1soc/064lig22wb_g.jpg

setshader stdworld

	texture 0 tech1soc/128-05b.jpg
	texture 0 tech1soc/128-05c.jpg
	texture 0 tech1soc/blank01a.jpg
	texture 0 tech1soc/blank01c.jpg
	texture 0 tech1soc/blank02a.jpg
	texture 0 tech1soc/blank02b.jpg
	texture 0 tech1soc/blank03a.jpg
	texture 0 tech1soc/blank03d.jpg
	texture 0 tech1soc/block01b.jpg
	texture 0 tech1soc/block01c.jpg
	texture 0 tech1soc/block10b.jpg
	texture 0 tech1soc/block19b.jpg
	texture 0 tech1soc/chain_mesh2.jpg
	texture 0 tech1soc/grate1b.jpg
	texture 0 tech1soc/grate_brown1.jpg
	texture 0 tech1soc/grate_brown3.jpg
	texture 0 tech1soc/grill_wall01b.jpg
	texture 0 tech1soc/half_grill_wall01b.jpg
	texture 0 tech1soc/half_grill_wall03b.jpg
	texture 0 tech1soc/mat4b.jpg
	texture 0 tech1soc/matbrown_lgt2.jpg
	texture 0 tech1soc/met_wall01a.jpg
	texture 0 tech1soc/met_wall01c.jpg
	texture 0 tech1soc/mix_wall03a.jpg
	texture 0 tech1soc/mix_wall03ab.jpg
	texture 0 tech1soc/o128-02a.jpg

setshader glowworld

	texture 0 tech1soc/octlig01bc.jpg
	texture g tech1soc/octlig01bc_g.jpg

setshader stdworld

	texture 0 tech1soc/panel20c.jpg
	texture 0 tech1soc/panel40c.jpg
	texture 0 tech1soc/s064-02a.jpg
	texture 0 tech1soc/s064-02b.jpg
	texture 0 tech1soc/s064-02c.jpg
	texture 0 tech1soc/s064-03a.jpg
	texture 0 tech1soc/s064-03b.jpg
	texture 0 tech1soc/s064-03c.jpg
	texture 0 tech1soc/s128-01c.jpg
	texture 0 tech1soc/s128-02a.jpg
	texture 0 tech1soc/s128-02b.jpg
	texture 0 tech1soc/s128-03b.jpg
	texture 0 tech1soc/s128-06b.jpg
	texture 0 tech1soc/s128-07e.jpg
	texture 0 tech1soc/s256-01c.jpg
	texture 0 tech1soc/s256-01d.jpg
	texture 0 tech1soc/s256-02a.jpg
	texture 0 tech1soc/s256-02b.jpg
	texture 0 tech1soc/spring1.jpg
	texture 0 tech1soc/spring2.jpg

//-lunaran

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld

	texture 0 lunaran/glue1_d.jpg
	texture n lunaran/glue1_local.jpg
	texture s lunaran/glue1_s.jpg
	texture z lunaran/glue1_h.jpg
	texture 0 lunaran/glue2_d.jpg
	texture n lunaran/glue2_local.jpg
	texture s lunaran/glue2_s.jpg
	texture z lunaran/glue2_h.jpg
	texture 0 lunaran/grate1_d.jpg
	texture n lunaran/grate1_local.jpg
	texture s lunaran/grate1_s.jpg
	texture z lunaran/grate1_h.jpg

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld

	texture 0 lunaran/panel64_2a_d.jpg
	texture n lunaran/panel64_2a_local.jpg
	texture s lunaran/panel64_2a_s.jpg
	texture z lunaran/panel64_2a_h.jpg
	texture 0 lunaran/panel64_2b_d.jpg
	texture n lunaran/panel64_2b_local.jpg
	texture s lunaran/panel64_2b_s.jpg
	texture z lunaran/panel64_2b_h.jpg
	texture 0 lunaran/panel64_2_d.jpg
	texture n lunaran/panel64_2_local.jpg
	texture s lunaran/panel64_2_s.jpg
	texture z lunaran/panel64_2_h.jpg

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld

	texture 0 lunaran/panel64_5_d.jpg
	texture n lunaran/panel64_5_local.jpg
	texture s lunaran/panel64_5_s.jpg
	texture z lunaran/panel64_5_h.jpg
	texture 0 lunaran/panel64_6b_d.jpg
	texture n lunaran/panel64_6b_local.jpg
	texture s lunaran/panel64_6b_s.jpg
	texture z lunaran/panel64_6b_h.jpg
	texture 0 lunaran/panel64_6_d.jpg
	texture n lunaran/panel64_6_local.jpg
	texture s lunaran/panel64_6_s.jpg
	texture z lunaran/panel64_6_h.jpg

setshader stdworld
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"
	texture 0 "textures/default.png"

setshader bumpspecmapparallaxworld

	texture 0 lunaran/cord1_d.jpg
	texture n lunaran/cord1_local.jpg
	texture s lunaran/cord1_s.jpg
	texture z lunaran/cord1_h.jpg

setshader bumpspecmapparallaxglowworld

	texture 0 lunaran/light_flouro1_d.jpg
	texture n lunaran/light_flouro1_local.jpg
	texture s lunaran/light_flouro1_s.jpg
	texture g lunaran/light_flouro1_g.jpg
	texture z lunaran/light_flouro1_h.jpg

setshaderparam "glowcolor" 1 1 1

	texture 0 lunaran/qcomp5_d.jpg
	texture n lunaran/qcomp5_local.jpg
	texture s lunaran/qcomp5_s.jpg
	texture g lunaran/qcomp5_glow.jpg
	texture z lunaran/qcomp5_h.jpg

	texture 0 lunaran/qcomp5_d.jpg
	texture n lunaran/qcomp5_local.jpg
	texture s lunaran/qcomp5_s.jpg
	texture g lunaran/qcomp5_glow2.jpg
	texture z lunaran/qcomp5_h.jpg

	texture 0 lunaran/light_fifty1_d.jpg
	texture n lunaran/light_fifty1_local.jpg
	texture s lunaran/light_fifty1_s.jpg
	texture g lunaran/light_fifty1_g.jpg
	texture z lunaran/light_fifty1_h.jpg

//--script

crnsp_clearalias = [
	loop i 200 [
		if (!=s (getalias (concatword level_trigger_ $i))) [
				(concatword level_trigger_ $i) = ""
		]
		if (!=s (getalias (concatword monster_dead_ $i))) [
				(concatword monster_dead_ $i) = ""
		]
	]
]
crnsp_clearalias
//-area code
crnsp_activearea = 0
crnsp_boundingboxarea1 = [4800.0 4960.0 3320.0 3460.0 5380.0 5465.0] //the areas bounding box, lower x - upper x, y-y, z-z
crnsp_boundingboxarea2 = [4910.0 5240.0 3740.0 4040.0 5340.0 5510.0]
crnsp_boundingboxarea3 = [4690.0 4930.0 3400.0 3790.0 5340.0 5630.0]
crnsp_boundingboxarea4 = [4920.0 5200.0 4020.0 4285.0 5960.0 6240.0]
crnsp_boundingboxarea5 = [4680.0 4870.0 3770.0 4020.0 6150.0 6290.0]
crnsp_boundingboxarea6 = [3918.0 4012.0 3984.0 4110.0 6160.0 6900.0]
crnsp_arealoop = [
	crnsp_camposx = (at (getcampos) 0)
	crnsp_camposy = (at (getcampos) 1)
	crnsp_camposz = (at (getcampos) 2)
	if (= (crnsp_insidearea $crnsp_camposx $crnsp_camposy $crnsp_camposz) 1) [
		[crnsp_doarea@crnsp_activearea] $crnsp_camposx $crnsp_camposy $crnsp_camposz
		sleep 100 [crnsp_arealoop]
	][
		if (= $crnsp_activearea 4) [
			if (> $crnsp_camposz 6150) [
				trigger 36 0
				crnsp_trigger36 = 0
			]
		]
		crnsp_activearea = 0 //player left area
	]	
]

crnsp_insidearea = [
		do [ && @(loopconcat i 6 [
				(? (mod $i 2) "<" ">") $[arg@(div (+ $i 2) 2)] (at $[crnsp_boundingboxarea@crnsp_activearea] $i)
		]) ]
]

crnsp_doarea1 = [	
	if (= $crnsp_taskelevatorid 1) [ 
		crnsp_elevatorloop 1 $arg1 $arg2 $arg3
	]
]
crnsp_doarea2 = [
	if (! $crnsp_triggerseemissile) [
		if (> (getcampitch) 60) [
			crnsp_triggerseemissile = 1
			sleep 1000 [crnsp_pthought "Wow... I'm right inside their missile silo!"]
			sleep 3000 [crnsp_psay "Bad news: These guys already have another missile ready to launch."]
			sleep 7500 [crnsp_csay "Oh damn, but we can't focus on that now. Just try to eliminate as many workers as possible on your way up."]
		]
	]
]

crnsp_doarea3 = [
	if (>= $crnsp_monster1 8) [
		if (= $crnsp_taskelevatorid 2) [
			crnsp_elevatorloop 2 $arg1 $arg2 $arg3
		]
	]
]

crnsp_doarea4 = [
	if (= $crnsp_taskelevatorid 3) [
		crnsp_elevatorloop 3 $arg1 $arg2 $arg3
	]
	if (= $crnsp_elevatorbool3 1) [
		trigger 34 1
	]
	if (&& (> $arg3 6150) (|| (|| (> $arg3 6210) (< $arg2 4100)) (|| (< $arg1 4970) (> $arg1 5140)))) [
		trigger 36 0
		crnsp_trigger36 = 0
	]
]

crnsp_doarea5 = [
	if (= $crnsp_taskelevatorid 4) [
		crnsp_elevatorloop 4 $arg1 $arg2 $arg3
	]
]

crnsp_doarea6 = [	
	if (= $crnsp_taskelevatorid 5) [
		crnsp_elevatorloop 5 $arg1 $arg2 $arg3
	]
]
//-elevator code

//elevator1
crnsp_elevatorpos1 = 5389.866
crnsp_elevatorposdown1 = 5389.351
crnsp_elevatorposup1 = 5438.0
crnsp_elevatorfloorheight1 = 5385.5
crnsp_elevatortime1 = 0
crnsp_elevatormaxtime1 = 1700
crnsp_squeezezone1 = 1100
crnsp_elevatorbool1 = -1
crnsp_elevatorsquare1 = [4835 4860 3395 3417]
alias level_trigger_150 [
	if $crnsp_trigger6 [
		if (= $crnsp_taskelevatorid 1) [
			if (= $crnsp_elevatortask 0) [
				crnsp_elevatortask = 1
			][
				if (= $crnsp_elevatortask -1) [
					crnsp_taskstack = 1
				]
			]
		][
			crnsp_taskelevatorid = 1
			crnsp_elevatortask = 1
			crnsp_taskstack = 0
		]
	]
]
alias level_trigger_151 [
	if $crnsp_trigger6 [
		if (= $crnsp_taskelevatorid 1) [
			if (= $crnsp_elevatortask 0) [
				crnsp_elevatortask = -1
			][
				if (= $crnsp_elevatortask 1) [
					crnsp_taskstack = 1
				]
			]
		][
			crnsp_taskelevatorid = 1
			crnsp_elevatortask = -1
			crnsp_taskstack = 0
		]
	]
]

//elevator2
crnsp_elevatorpos2 = 5390.2
crnsp_elevatorposdown2 = 5390.2
crnsp_elevatorposup2 = 5517.98
crnsp_elevatorfloorheight2 = 5386.0
crnsp_elevatortime2 = 0
crnsp_elevatormaxtime2 = 4300
crnsp_squeezezone2 = 1100
crnsp_elevatorbool2 = -1
crnsp_elevatorsquare2 = [4804 4860 3682 3700]
alias level_trigger_152 [
	if (= $crnsp_taskelevatorid 2) [
		if (= $crnsp_elevatortask 0) [
			crnsp_elevatortask = 1
		][
			if (= $crnsp_elevatortask -1) [
				crnsp_taskstack = 1
			]
		]
	][
		crnsp_taskelevatorid = 2
		crnsp_elevatortask = 1
		crnsp_taskstack = 0
	]
]
alias level_trigger_153 [
	if (= $crnsp_taskelevatorid 2) [
		if (= $crnsp_elevatortask 0) [
			crnsp_elevatortask = -1
		][
			if (= $crnsp_elevatortask 1) [
				crnsp_taskstack = 1
			]
		]
	][
		crnsp_taskelevatorid = 2
		crnsp_elevatortask = -1
		crnsp_taskstack = 0
	]
]

//elevator3
crnsp_elevatorpos3 = 5965.5
crnsp_elevatorposdown3 = 5965.5
crnsp_elevatorposup3 = 6517.98
crnsp_elevatorfloorheight3 = 5962
crnsp_elevatortime3 = 0
crnsp_elevatormaxtime3 = 6500
crnsp_squeezezone3 = 1100
crnsp_elevatorbool3 = -1
crnsp_elevatorsquare3 = [5010 5100 4170 4216]
level_trigger_154 = [
	if (= $crnsp_taskelevatorid 3) [
		if (= $crnsp_elevatortask 0) [
			crnsp_elevatortask = 1
		][
			if (= $crnsp_elevatortask -1) [
				crnsp_taskstack = 1
			]
		]
	][
		crnsp_taskelevatorid = 3
		crnsp_elevatortask = 1
		crnsp_taskstack = 0
	]
]

//elevator4
crnsp_elevatorpos4 = 6181.6
crnsp_elevatorposdown4 = 6181.6
crnsp_elevatorposup4 = 6238.0
crnsp_elevatorfloorheight4 = 6178
crnsp_elevatortime4 = 0
crnsp_elevatormaxtime4 = 2000
crnsp_squeezezone4 = 1100
crnsp_elevatorbool4 = -1
crnsp_elevatorsquare4 = [4760 4784 3832 3852]
alias level_trigger_156 [
	if (= $crnsp_taskelevatorid 4) [
		if (= $crnsp_elevatortask 0) [
			crnsp_elevatortask = 1
		][
			if (= $crnsp_elevatortask -1) [
				crnsp_taskstack = 1
			]
		]
	][
		crnsp_taskelevatorid = 4
		crnsp_elevatortask = 1
		crnsp_taskstack = 0
	]
]
alias level_trigger_157 [
	sleep 15000 [
		if (&& (= $crnsp_monster6 0) (! $crnsp_bridgehint)) [
			crnsp_bridgehint = 1
			crnsp_csay "You have to eliminate the two workers in the bridge control room."
		]
	]
	if (= $crnsp_taskelevatorid 4) [
		if (= $crnsp_elevatortask 0) [
			crnsp_elevatortask = -1
		][
			if (= $crnsp_elevatortask 1) [
				crnsp_taskstack = 1
			]
		]
	][
		crnsp_taskelevatorid = 4
		crnsp_elevatortask = -1
		crnsp_taskstack = 0
	]
]

//elevator5
crnsp_elevatorpos5 = 6189.75
crnsp_elevatorposdown5 = 6189.75
crnsp_elevatorposup5 = 6838.0
crnsp_elevatorfloorheight5 = 6186
crnsp_elevatortime5 = 0
crnsp_elevatormaxtime5 = 21700
crnsp_squeezezone5 = 1100
crnsp_elevatorbool5 = -1
crnsp_elevatorsquare5 = [3979 4000 4064 4092]
level_trigger_158 = [
	if (= $crnsp_taskelevatorid 5) [
		if (= $crnsp_elevatortask 0) [
			crnsp_elevatortask = 1
		][
			if (= $crnsp_elevatortask -1) [
				crnsp_taskstack = 1
			]
		]
	][
		crnsp_taskelevatorid = 5
		crnsp_elevatortask = 1
		crnsp_taskstack = 0
	]
]

//general
crnsp_elevatortask = 0
crnsp_taskstack = 0
crnsp_taskelevatorid = 0
crnsp_squeezedtimer = 0
crnsp_lastposz = 0
crnsp_elevatorstuck = 0
crnsp_elevatorloop = [
	crnsp_tempdif = (-f $[crnsp_elevatorpos@arg1] $arg4)
	if (= $crnsp_elevatortask 1) [
		if (<f $crnsp_tempdif 5) [
			crnsp_elevatormoveup $arg1 $arg2 $arg3 $arg4  $crnsp_tempdif
		][
			platform $arg1 0
			if (&& (=f $crnsp_lastposz $arg4) (<f $crnsp_tempdif 10))[
				if (! $crnsp_elevatorstuck) [
					crnsp_pthought "I'm just hanging around here."
				]
				crnsp_elevatorstuck = 1
			][
				crnsp_elevatorstuck = 0
			]			
			if (= $crnsp_elevatorstuck 0) [
				crnsp_elevatortask = -1
				crnsp_taskstack = 1
			]
		]		
	]
	if (= $crnsp_elevatortask -1) [
		crnsp_elevatormovedown $arg1 $arg2 $arg3 $arg4 $crnsp_tempdif
	]
	if (= $[crnsp_elevatorbool@arg1] $crnsp_elevatortask) [
		if $crnsp_taskstack [
			crnsp_taskstack = 0
			crnsp_elevatortask = (* $crnsp_elevatortask -1)
		][
			crnsp_elevatortask = 0
		]
	]
	if $[crnsp_elevatorbool@arg1] [ 
		platform $arg1 $[crnsp_elevatorbool@arg1]
	]
	crnsp_lastposz = $arg4
]

crnsp_elevatormoveup = [
	crnsp_tempinsideelevator = (&& [
			>f $arg2 (at $[crnsp_elevatorsquare@arg1] 0)
	] [
			<f $arg2 (at $[crnsp_elevatorsquare@arg1] 1)
	] [
			>f $arg3 (at $[crnsp_elevatorsquare@arg1] 2)
	] [
			<f $arg3 (at $[crnsp_elevatorsquare@arg1] 3)
	])
	crnsp_leftearly = (> 400 (- $[crnsp_elevatormaxtime@arg1] $[crnsp_elevatortime@arg1]))
	if (|| $crnsp_tempinsideelevator $crnsp_leftearly) [	
		platform $arg1 1
		//echo (concat "moveup: time" $[crnsp_elevatortime@arg1] "pos" $[crnsp_elevatorpos@arg1] "absolute" $arg4)
		[crnsp_elevatorbool@arg1] = 0
		[crnsp_elevatortime@arg1] = (+ $[crnsp_elevatortime@arg1] 100)
		[crnsp_elevatorpos@arg1] = (+f $[crnsp_elevatorposdown@arg1] (*f 30 (divf $[crnsp_elevatortime@arg1] 1000)))
		if (= $[crnsp_elevatortime@arg1] $[crnsp_elevatormaxtime@arg1]) [
				[crnsp_elevatorbool@arg1] = 1
				[crnsp_elevatorpos@arg1] = $[crnsp_elevatorposup@arg1]
		]
	] [
		if (< $arg4 (-f $[crnsp_elevatorposup@arg1] 4)) [
				platform $arg1 0
		]
	]
]

crnsp_elevatormovedown = [
	if (&& [> $[crnsp_squeezezone@arg1] $[crnsp_elevatortime@arg1]] [< 400 $[crnsp_elevatortime@arg1]]) [
		crnsp_tempinsideelevatoroffset = 20
	][
		crnsp_tempinsideelevatoroffset = 7
	]
	crnsp_tempinsideelevator = (&& [
		> $arg2 (-f (at $[crnsp_elevatorsquare@arg1] 0) $crnsp_tempinsideelevatoroffset)
		] [
			< $arg2 (+f (at $[crnsp_elevatorsquare@arg1] 1) $crnsp_tempinsideelevatoroffset)
		] [
			> $arg3 (-f (at $[crnsp_elevatorsquare@arg1] 2) $crnsp_tempinsideelevatoroffset)
		] [
			< $arg3 (+f (at $[crnsp_elevatorsquare@arg1] 3) $crnsp_tempinsideelevatoroffset)
		])
	if (= $crnsp_tempinsideelevatoroffset 7) [
		crnsp_tempalmostdown = (> 500 $[crnsp_elevatortime@arg1])
		crnsp_elevatormovedownt = (|| $crnsp_tempinsideelevator (>f $arg5 5) $crnsp_tempalmostdown)
	][
		crnsp_elevatormovedownt = (^ $crnsp_tempinsideelevator (>f $arg5 5))
	]
	if (&& $crnsp_elevatormovedownt [> $[crnsp_elevatortime@arg1] 0]) [
		platform $arg1 -1
		crnsp_squeezedtimer = 0
		//echo (concat "movedown: time" ($(concatword "crnsp_elevatortime" $arg1)) "pos" ($(concatword "crnsp_elevatorpos" $arg1)) "absolute" $arg4)
		[crnsp_elevatorbool@arg1] = 0
		[crnsp_elevatortime@arg1] = (- $[crnsp_elevatortime@arg1] 100)
		[crnsp_elevatorpos@arg1] = (-f $[crnsp_elevatorpos@arg1] 3)
		if (= $[crnsp_elevatortime@arg1] 0) [
				[crnsp_elevatorbool@arg1] = -1
				[crnsp_elevatorpos@arg1] = $[crnsp_elevatorposdown@arg1]
		]
	][
		platform $arg1 0
		//crnsp_tempinsideelevator = (&& (&& (>f $arg2 (at ($(concatword "crnsp_elevatorsquare" $arg1)) 0)) (<f $arg2 (at ($(concatword "crnsp_elevatorsquare" $arg1)) 1)))(&& (>f $arg3 (at ($(concatword "crnsp_elevatorsquare" $arg1)) 2)) (<f $arg3 (at ($(concatword "crnsp_elevatorsquare" $arg1)) 3))))
		crnsp_tempinsideelevator = (&& [
				>f $arg2 (at $[crnsp_elevatorsquare@arg1] 0)
		] [
				<f $arg2 (at $[crnsp_elevatorsquare@arg1] 1)
		] [
				>f $arg3 (at $[crnsp_elevatorsquare@arg1] 2)
		] [
				<f $arg3 (at $[crnsp_elevatorsquare@arg1] 3)
		])
		crnsp_tempplatformheight = (-f ($(concatword "crnsp_elevatorposdown" $arg1)) ($(concatword "crnsp_elevatorfloorheight" $arg1)))
		crnsp_tempplatformentranceheight = (+f (+f $crnsp_tempplatformheight 0.5) ($(concatword "crnsp_elevatorfloorheight" $arg1)))
		 crnsp_tempsqueezed = (&& $crnsp_tempinsideelevator [
				<f $arg4 $crnsp_tempplatformentranceheight
		] [
				>f $[crnsp_elevatorpos@arg1] (+f (+f 14 $crnsp_tempplatformheight) $[crnsp_elevatorfloorheight@arg1])
		] [
				<f $[crnsp_elevatorpos@arg1] (+f 25 $crnsp_tempplatformentranceheight)
		])
		if $crnsp_tempsqueezed [
			if (> 10 $crnsp_squeezedtimer) [
				crnsp_squeezedtimer = (+ $crnsp_squeezedtimer 1)
			][
				crnsp_elevatormoveup $arg1 $arg2 $arg3 $arg4 $arg5
			]
		]
	]
]
//-initialize

crnsp_trigger2 = 1
crnsp_trigger2a = 0
crnsp_trigger3a = 0
crnsp_trigger3b = 1
crnsp_trigger5 = 0
crnsp_trigger6 = 0
crnsp_trigger8 = 0
crnsp_trigger9a = 1
crnsp_trigger10a = 1
crnsp_triggerseemissile = 0
crnsp_trigger22 = 0
crnsp_trigger22a = 0
crnsp_trigger22b = 0
crnsp_trigger22c = 0
sleep 1000 [trigger 27 1]
crnsp_trigger28 = 1
crnsp_trigger32 = 0
crnsp_trigger35 = 0
crnsp_trigger36 = 0
crnsp_trigger37 = 0
crnsp_trigger46 = 0
crnsp_trigger48 = 0
crnsp_bridgehint = 0
endswitchhint = 1
crnsp_timerpass = 0
crnsp_timerctr = 0
crnsp_timertrigger = -1
crnsp_timertime = 0

crnsp_monster1 = 0
crnsp_monster3 = 0
crnsp_monster4 = 0
crnsp_monster5 = 0
crnsp_monster6 = 0
crnsp_monster7 = 0

crnsp_csay = [echo (concatword "^f8Commander: ^f6" $arg1 )]
crnsp_psay = [echo (concatword "^f8" (getname) ": ^f1" $arg1 )]
crnsp_pthought = [echo (concatword "^f2" $arg1)]

//-level triggers from the playerstart up to the carrot

alias level_trigger_1 [
	skill 10
	sleep 500 [echo ""; crnsp_csay "I see you survived the teleportation and are now right in front of our target area. But we haven't got enough energy to send you more soldiers."]
	sleep 5500 [crnsp_psay "Great, and now?"]
	sleep 7500 [crnsp_csay "Since we're running out of time you have to go on alone and shut down this ^f2Dark Matter Bomb ^f6before it reaches us on earth."]
	sleep 11000 [
		if $crnsp_trigger2a [
			crnsp_psay "Alright, I will do my best! I see an antenna up there in the fog. Maybe there is the control center from where I can send the shut down code to the bomb."
			sleep 6000 [crnsp_csay "Yes, that sounds like a good plan. Oh and you have an key card in your bag to enter this first building over there."; crnsp_trigger3a = 1]
		][
			crnsp_trigger2a = 1
			crnsp_psay "Okay, I got that."
			sleep 1500 [crnsp_csay "Now run over to the security entrance. You can get in there with the key card we put in your bag."; crnsp_trigger3a = 1]
		]
	]
]

alias level_trigger_2 [
	if $crnsp_trigger2 [
		if $crnsp_trigger2a [
			sleep 2000 [crnsp_pthought "Hmm... There is an antenna on top of the left mountain. I bet there is the control center from where I can disable the bomb."]
		]
		crnsp_trigger2a = 1
	]
	crnsp_trigger2 = 0
]

alias level_trigger_3 [
	if $crnsp_trigger3a [
		if $crnsp_trigger3b [
			echo "^f4~ key card accepted ~"
			crnsp_trigger3b = 0
		]
		trigger 4 1
	][
		echo "^f4~ enter a key card ~"
	]
]

alias level_trigger_5 [
	trigger 4 0
	crnsp_trigger3b = 1
]

alias level_trigger_6 [
	crnsp_trigger6 = 1
	echo "^f4~ elevator powered on ~"
	sound (registersound "kaiser/fx/hum6")
]
alias level_trigger_7 [
	if (! $crnsp_trigger6) [
		crnsp_pthought "Hmm... Somewhere must be a switch to power this elevator on."
	]
]

alias level_trigger_8 [
	echo "^f4~ lower entrance opened ~"
	crnsp_trigger8 = 1
	sleep 1000 [crnsp_csay "Well done. You now have access to the inner part of the mountain."]
	sleep 4000 [if $crnsp_trigger9a [crnsp_pthought "Hmm... The entrance must be somewhere behind the next corner."]]
]

alias level_trigger_9 [
	crnsp_trigger9a = 0
	if $crnsp_trigger8 [
		sleep 500 [trigger 11 1]
	]	
]

alias level_trigger_10 [
	if $crnsp_trigger8 [
		trigger 11 1
	][
		if $crnsp_trigger10a [
			crnsp_trigger10a = 0
			crnsp_csay "Seems like you have to unlock this gate first."
		]
	]	
]

alias level_trigger_12 [
	trigger 11 0
]

alias level_trigger_13 [
	trigger 14 1
]

alias level_trigger_15 [
	trigger 14 0
	if $crnsp_triggerseemissile [
		trigger 16 1
	]
	if (! $crnsp_trigger5) [
		sleep 10000 [
			if (! $crnsp_triggerseemissile) [
				crnsp_pthought "Hmm.. What needs such a big foundation?"
			]
		]
	]
	crnsp_trigger5 = 1
]

alias level_trigger_17 [
	trigger 16 0
]

alias level_trigger_18 [
	trigger 14 0
	trigger 16 0
	trigger 19 1
	sleep 500 [trigger 20 1]
	sleep 5000 [trigger 22 1 ; trigger 23 1]
]

alias level_trigger_21 [
	trigger 19 0
	trigger 22 1
	sleep 500 [trigger 23 1]
]

alias level_trigger_41 [
	trigger 42 1
]

alias monster_dead_1 [
	crnsp_monster1 = (+ $crnsp_monster1 1)
]

alias level_trigger_22 [
	if (& (! $crnsp_trigger22) (! $crnsp_trigger22c))  [
		crnsp_trigger22 = 1
		crnsp_trigger22a = 1
		platform 6 1 ; platform 7 1
		sleep 300 [platform 6 0 ; platform 7 0]
		sleep 1000 [platform 6 -1 ; platform 7 -1]
		sleep 1300 [
			platform 6 0 ; platform 7 0
			crnsp_csay "Look like this elevator is blocked. You'll have to find another way up. Maybe trough some broken grill or so."
			crnsp_trigger22a = 0
			if $crnsp_trigger22b [
				crnsp_trigger22c = 1
				platform 7 -1
			]
		]
	]
]

alias monster_dead_2 [
	if $crnsp_trigger32 [
		crnsp_pthought "Zzz.. Always those vermins."
	][
		echo "^f4~ a secret chamber opened ~"
		sound 31
		if (! $crnsp_trigger22a) [
			crnsp_trigger22c = 1
			platform 7 -1
			sleep 550 [platform 7 0]
		][
			crnsp_trigger22b = 1
		]
	]
]

alias level_trigger_23 [
	sleep 500 [platform 7 1]
	sleep 1050 [platform 7 0 ; crnsp_trigger22c = 0]
]

alias level_trigger_24 [
	crnsp_psay "Ah, I found a broken grill and entered a storage room."
]

alias level_trigger_25 [
	sleep 1500 [crnsp_psay "I am outside again. Let's see if the way leads me further to the top."]
]

alias level_trigger_26 [
	if $crnsp_trigger28 [
		sleep 1500 [crnsp_csay "There must somewhere be a control panel to close the bridge's floor."]
	]
]

alias level_trigger_28 [
	trigger 27 0
	echo "^f4~ bridge opened ~"
	crnsp_trigger28 = 0
	sleep 500 [crnsp_psay "Great, I found a switch!"]
]

alias level_trigger_29 [
	crnsp_pthought "Hey.. maybe this tunnel leads to a control panel for the bridge."
]

alias level_trigger_30 [
	trigger 31 1
]

alias level_trigger_32 [
	crnsp_trigger32 = 1
	trigger 31 0
]

alias level_trigger_35 [
	if (&& $crnsp_trigger35 $crnsp_trigger37) [
		trigger 36 1
		crnsp_trigger36 = 1
		sleep 500 [trigger 38 1] 
	]
	crnsp_trigger35 = 1	
]

alias level_trigger_37 [
	crnsp_trigger37 = 1
]

alias monster_dead_3 [
	crnsp_monster3 = (+ 1 $crnsp_monster3)
	if (= $crnsp_monster3 5) [
		crnsp_pthought "I'm sure that weren't all of them."
		sleep 5000  [
			sound $crnsp_warning
			trigger 39 1
		]
		sleep 6200 [
			sound $crnsp_warning
			trigger 44 1
		]
		sleep 7500 [
			sound $crnsp_warning
			trigger 43 1
		]
	]
]

alias level_trigger_40 []
alias level_trigger_47 []

alias monster_dead_4 [
	crnsp_monster4 = (+ 1 $crnsp_monster4)
	if (=  $crnsp_monster4 28) [
		trigger 45 1
	]
]

alias level_trigger_48 [
	if (= $crnsp_trigger48 0) [
		if (= $crnsp_monster4 28) [
			crnsp_trigger48 = 1
			trigger 39 0
			trigger 43 0
			trigger 44 0
			trigger 40 1
			platform 8 1
		]
	]
	if (= $crnsp_trigger48 1) [
		if $crnsp_trigger46 [
			crnsp_trigger48 = -1
			trigger 45 0
			trigger 47 1
			sleep 1000 [platform 9 1]
			sleep 2000 [trigger 45 1]
		]
	]
]

alias level_trigger_46 [
	if (= $crnsp_trigger48 1) [
		if (! $crnsp_trigger46) [
			crnsp_trigger46 = 1			
			sleep 1000 [sound $crnsp_warning]
			sleep 2000 [
				trigger 39 1
				trigger 43 1
				trigger 44 1
			]
		]
	]
]

alias monster_dead_5 [
	crnsp_monster5 = (+ 1 $crnsp_monster5)
	if (=  $crnsp_monster5 35) [
		trigger 49 1
	]
]

alias level_trigger_51 [
	echo "^f4~ first bridge gate opened ~"
]

alias monster_dead_6 [
	crnsp_monster6 = (+ 1 $crnsp_monster6)
	if (= $crnsp_monster6 1) [
		crnsp_csay "There's only one worker remaining."
	]
	if (= $crnsp_monster6 2) [
		echo "^f4~ second bridge gate opened ~"
		trigger 52 1
	]
]

alias level_trigger_55 [
	if (= $crnsp_monster6 2) [
		trigger 53 1
		sleep 1500 [trigger 54 1]
	][
		if (! $crnsp_bridgehint) [
			crnsp_bridgehint = 1
			crnsp_csay "Looks like that gate is blocked by the workers in the control room over here."
		]
	]
]

alias level_trigger_57 [
	trigger 58 1
]

alias monster_dead_7 [
	crnsp_monster7 = (+ 1 $crnsp_monster7)
	if (= $crnsp_monster7 28) [
		trigger 59 1
		crnsp_psay "The door to their control center opened!"
		crnsp_csay "That's good news. Now try to find some control panels, which shut down the bomb."
	]
]

crnsp_timerloop = [	
	crnsp_timertime = (- $crnsp_timertime 1000)
	if (= $crnsp_timertime 0) [
		crnsp_timerctr = 0
		crnsp_timertrigger = -1
		if (! $crnsp_timerpass) [
			sound (registersound "ctf/flagreturn" 200)
			if $endswitchhint [
				crnsp_pthought "Hmm.. seems like I have to activate both switches in a short period of time."
				endswitchhint = 0
			]
		]
	][
		sleep 1000 [crnsp_timerloop]
		sound $crnsp_timertick
	]
]

crnsp_timer = [
	if (! $crnsp_timerpass) [
		if (= $crnsp_timerctr 0) [
			crnsp_timerctr = 1
			crnsp_timertrigger = $arg1
			crnsp_timertime = 4000
			sleep 1000 [crnsp_timerloop]
			sound $crnsp_timertick
		][
			if (> $crnsp_timertime 0) [
				if (! (= $arg1 $crnsp_timertrigger)) [
					crnsp_timerpass = 1
					sound (registersound "q009/quaddamage_shoot")
					sleep 500 [crnsp_csay "Fantastic, you've done it! The bomb is in it's self destruction mode and no longer a threat for our earth."]
					sleep 2000 [crnsp_psay "Yeah, that sounds great, but how can I get out of this place?"]
					sleep 4000 [crnsp_csay "Just go up to the roof and our men will soon pick you up there."]
					sleep 5000 [trigger 60 1]
				]
			]
		]
	]
]

alias level_trigger_61 [
	crnsp_timer 0
]

alias level_trigger_62 [
	crnsp_timer 1
]

alias level_trigger_63 [	
	echo ""
	echo "^f2Thanks to ^f6Simon O'Callaghan ^f2for the textures"
	echo "^f2and ^f6Skur ^f2for always helpful advice during the building process."
	echo ""
	echo "^f2Thank You for playing ^f3Missile Pass ^f2by ^f6crun ^f2in Summer 2013"
	echo ""
]

alias level_trigger_64 [	
	crnsp_clearalias
]
alias level_trigger_100 [
	if (= $crnsp_activearea 0)[
		crnsp_activearea = 1
		crnsp_arealoop
	]
]

alias level_trigger_101 [	
	if (= $crnsp_activearea 0)[
		crnsp_activearea = 2
		crnsp_arealoop
	]
]

alias level_trigger_102 [
	trigger 24 1
	if (= $crnsp_activearea 0)[
		crnsp_activearea = 3
		crnsp_arealoop
	]
]

alias level_trigger_103 [
	trigger 33 1
	if (= $crnsp_activearea 0)[
		crnsp_activearea = 4
		crnsp_arealoop
	]
]

alias level_trigger_104 [
	trigger 50 1
	if (= $crnsp_activearea 0)[
		crnsp_activearea = 5
		crnsp_arealoop
	]
]

alias level_trigger_105 [
	if (= $crnsp_activearea 0)[
		crnsp_activearea = 6
		crnsp_arealoop
	]
]
leet = 1337